package com.example.rastro;

import java.util.regex.*;

import Thread.*;
import android.app.*;
import android.content.*;
import android.os.*;
import android.view.*;
import android.view.View.OnClickListener;
import android.view.View.OnFocusChangeListener;
import android.widget.*;


public class JoinForm extends Activity {
	ArrayAdapter<CharSequence> adspin;
	
	Button joinBtn,fbloginBtn;
	TextView loginTv;
	String sex,name,email,pwd,dob,year,month,day;
	String emailRegex="^[a-zA-Z0-9-_]+@[a-zA-Z0-9-_]+(.[a-zA-Z0-9-_]+)*$";
	String pwdRegex = "^(?=.*[a-zA-Z])(?=.*[0-9]).{8,16}$";
	String pwdRegex2 = "^[0-9]*$";
	EditText editName,editEmail,editPwd,editYear,editMonth,editDay;
	ProgressDialog dialog = null;
	RadioGroup radiogroup;
	RadioButton rbMan,rbWoman;
	RbPreference pref;
	loginThread lT;
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.joinform);
		loginTv = (TextView)findViewById(R.id.login);
		joinBtn = (Button)findViewById(R.id.joinBtn);
		editEmail = (EditText)findViewById(R.id.editEmail);
		editPwd = (EditText)findViewById(R.id.editPwd);
		editName = (EditText)findViewById(R.id.editName);
		fbloginBtn = (Button)findViewById(R.id.fbBtn);
		
		
//		//이메일 유효성검사
//		editEmail.setOnFocusChangeListener(new OnFocusChangeListener() {
//			@Override
//			public void onFocusChange(View v, boolean hasFocus) {
//				// TODO Auto-generated method stub
//					if(editEmail.getText().toString().length()>0){
//						if(hasFocus==false){
//							Pattern pattern = Pattern.compile(emailRegex);
//							Matcher matcher = pattern.matcher(editEmail.getText().toString());
//							if(matcher.matches()){
//								
//							}else{
//								
//								Toast.makeText(JoinForm.this, getString(R.string.emailRegex), Toast.LENGTH_SHORT).show();
//								
//								editEmail.setText("");
//								
//							}
//								
//						}
//				}
//			}
//		});
//		
//		//로그인화면으로 전환
//		loginTv.setOnClickListener(new OnClickListener() {
//			
//			@Override
//			public void onClick(View v) {
//				// TODO Auto-generated method stub
//				pref = new RbPreference(JoinForm.this);
//				if(pref.getValue("email", "")=="" && pref.getValue("pwd", "")==""){
//					startActivity(new Intent(JoinForm.this,loginForm.class));
//					finish();
//				}else{
//					String email1 = pref.getValue("email", "");
//					String pwd1 = pref.getValue("pwd", "");
//					String url = "http://rastro.kr/app/loginChk.php";
//					dialog = ProgressDialog.show(JoinForm.this, "", "Loading.....");
//					lT = new loginThread(email1, pwd1, url, mHandler,dialog);
//					lT.start();
//				}
//				System.out.println(pref.getValue("email", ""));
//				
//			}
//		});
		//회원가입(DB에 데이터 저장)
//		joinBtn.setOnClickListener(new OnClickListener() {
//			
//			@Override
//			public void onClick(View v) {
//				// TODO Auto-generated method stub
//			
//				 
//				 name = editName.getText().toString();
//				 email = editEmail.getText().toString();
//				
//				 if(name.length()<=0){
//					Toast.makeText(JoinForm.this, getString(R.string.NameInputLimit),Toast.LENGTH_SHORT).show();
//					return;
//				 }
//				 if(email.length()<=0){
//						Toast.makeText(JoinForm.this, getString(R.string.EmailInputLimit),Toast.LENGTH_SHORT).show();
//						return;
//				}
//				
//
//				dialog = ProgressDialog.show(JoinForm.this, "", "Loading.....");
//				 String  URL = "http://rastro.kr/app/appJoinInsert.php";
////				 String URL = "http://rastro.kr/mailTest.php";
//				 
//				 joinThread jT = new joinThread(name,email,mHandler,URL);
//				 jT.start();
//			}
//		});
//		fbloginBtn.setOnClickListener(new OnClickListener() {
//			
//			@Override
//			public void onClick(View v) {
//				// TODO Auto-generated method stub
//				startActivity(new Intent(JoinForm.this,fbLogin.class));
//			}
//		});
		
	}//결과값 표시?
	Handler mHandler = new Handler(){
		public void handleMessage(Message msg){
			if(msg.what==0){
				editName.setText("");
				editEmail.setText("");
				editPwd.setText("");
				editDay.setText("");
				editMonth.setText("");
				editYear.setText("");
				editName.setFocusable(true);
				editName.requestFocus();
				dialog.dismiss();
				new AlertDialog.Builder(JoinForm.this)
				.setMessage("회원가입이 완료되었습니다. 인증메일 확인후 로그인 하세요.")
				.setCancelable(false)
				.setNegativeButton("닫기", null)
			.show();
				
			}
			if(msg.what==1){
				editEmail.setText("");
				dialog.dismiss();
				new AlertDialog.Builder(JoinForm.this)
				.setMessage("이메일이 중복입니다. 다시 입력 해주세요.")
				.setCancelable(false)
				.setNegativeButton("닫기", null)
				.show();
			}
			if(msg.what==2){
				dialog.dismiss();
			}
			if(msg.what==3){
				
				Bundle bundle = msg.getData();
				String i = bundle.getString("idx");
				Intent intent = new Intent(JoinForm.this,profileForm.class);
				intent.putExtra("i", i);
				startActivity(intent);
				dialog.dismiss();
				lT.interrupt();
				finish();
			}
		}
	};
}
