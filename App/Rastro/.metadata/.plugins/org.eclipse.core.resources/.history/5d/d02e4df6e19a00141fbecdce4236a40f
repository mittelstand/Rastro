package FileTransmi;

import java.io.*;
import java.util.*;

import org.apache.http.*;
import org.apache.http.client.*;
import org.apache.http.client.entity.*;
import org.apache.http.client.methods.*;
import org.apache.http.impl.client.*;
import org.apache.http.message.*;
import org.apache.http.params.*;

import android.os.*;

public class FileDownload extends Thread{
	String idx;
	Handler handler;
	public FileDownload(String idx, Handler handler) {
		// TODO Auto-generated constructor stub
	this.idx=idx;
	this.handler = handler;
	}
	@Override
	public void run() {
		// TODO Auto-generated method stub
		super.run();
		FD();
	}
	public void FD(){
		try{
			 HttpClient httpclient = new DefaultHttpClient();
		     	
  			
  			ArrayList<NameValuePair> post = new ArrayList<NameValuePair>();
  			
  			post.add(new BasicNameValuePair("idx", idx));
  			
  			
  			System.out.println(post);
  			String result="";
  			HttpParams params = httpclient.getParams();
  			HttpConnectionParams.setConnectionTimeout(params, 5000);
  			System.out.println("연결되나요?");
  			
  			HttpPost httppost = new HttpPost("http://rastro.kr/app/FileDownload.php");
  			UrlEncodedFormEntity entityRequest = new UrlEncodedFormEntity(post,"UTF-8");
  			httppost.setEntity(entityRequest);
  			System.out.println("못받나요?");
  			HttpResponse response = httpclient.execute(httppost);
  			System.out.println("안되나요?");
  			
  			HttpEntity entityResponse = response.getEntity();
  			InputStream is = entityResponse.getContent();
 			
 			BufferedReader reader = new BufferedReader(new InputStreamReader(is,"UTF-8"),8);
 			StringBuilder sb=new StringBuilder();
 			String line = null;
 			while((line = reader.readLine())!=null){
 				sb.append(line);
 			}
 			
 			is.close();
 			result=sb.toString();
 			String[] tmUrl = result.split("/");
 			String url = tmUrl[2]+"/"+tmUrl[4]+"/"+tmUrl[5];
 			
 			System.out.println(result);
 			System.out.println(url);
 			httpclient.getConnectionManager().shutdown();
 			
 			
		}catch(Exception e){
			
		}
	}
}
