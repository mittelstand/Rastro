package com.example.rastro;

import Thread.*;
import android.app.*;
import android.content.*;
import android.os.*;
import android.widget.*;

public class Intro extends Activity{
	ProgressDialog dialog = null;
	loginThread lT;
	FacebookLoginThread Flt;
	RbPreference pref;
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		// TODO Auto-generated method stub
		super.onCreate(savedInstanceState);
		setContentView(R.layout.intro);
		Handler handler =new android.os.Handler();
		handler.postDelayed(new Runnable() {
			
			@Override
			public void run() {
				// TODO Auto-generated method stub
				Intent intent = new Intent(Intro.this,JoinForm.class);
				startActivity(intent);
				finish();
			}
		}, 2000);
	}
	public void autoLogin(){
		pref = new RbPreference(Intro.this);
		if(pref.getValue("email", "")=="" && pref.getValue("pwd", "")=="" && pref.getValue("id", "")==""){
			
		}if(pref.getValue("email", "")!="" && pref.getValue("pwd","")!=""){
			String email1 = pref.getValue("email", "");
			String pwd1 = pref.getValue("pwd", "");
			String url = "http://rastro.kr/app/loginChk.php";
			dialog = ProgressDialog.show(Intro.this, "", "Loading.....");
			lT = new loginThread(email1, pwd1, url, mHandler,dialog);
			lT.start();
		}if(pref.getValue("id", "")!=""){
			String id1 = pref.getValue("id", "");
			String url="http://rastro.kr/app/appFbLoginChk.php";
			dialog = ProgressDialog.show(Intro.this, "", "Loading.....");
			Flt = new FacebookLoginThread(mHandler, url,id1);
			Flt.start();
		}
	}
	Handler mHandler = new Handler(){
		public void handleMessage(Message msg){
			if(msg.what==0){
				editName.setText("");
				editEmail.setText("");
				editPwd.setText("");
				
				editName.setFocusable(true);
				editName.requestFocus();
				dialog.dismiss();
				new AlertDialog.Builder(JoinForm.this)
				.setMessage(getString(R.string.joinchk))
				.setCancelable(false)
				.setNegativeButton("닫기", new DialogInterface.OnClickListener() {
					
					@Override
					public void onClick(DialogInterface dialog, int which) {
						// TODO Auto-generated method stub
						startActivity(new Intent(JoinForm.this,loginForm.class));
							
					}
				})
			.show();
				
			}
			if(msg.what==1){
				editEmail.setText("");
				dialog.dismiss();
				new AlertDialog.Builder(JoinForm.this)
				.setMessage(getString(R.string.Emailoverlap))
				.setCancelable(false)
				.setNegativeButton("닫기", null)
				.show();
			}
			if(msg.what==2){
				dialog.dismiss();
			}
			if(msg.what==3){
				
				Bundle bundle = msg.getData();
				String i = bundle.getString("idx");
				Intent intent = new Intent(JoinForm.this,profileForm.class);
				intent.putExtra("i", i);
				startActivity(intent);
				finish();
				dialog.dismiss();
				lT.interrupt();
				
			}
			if(msg.what==4){
				
				dialog.dismiss();
				new AlertDialog.Builder(JoinForm.this)
				.setMessage("페이스북으로 가입이 되었습니다.")
				.setCancelable(false)
				.setNegativeButton("닫기", null)
				.show();
			}
			if(msg.what==5){
				dialog.dismiss();
				Toast.makeText(JoinForm.this, "연결 실패", Toast.LENGTH_SHORT).show();
			}
			if(msg.what==6){
				dialog.dismiss();
				new AlertDialog.Builder(JoinForm.this)
				.setMessage("페이스북으로 이미 가입하였습니다.")
				.setCancelable(false)
				.setNegativeButton("닫기", null)
				.show();
			}
			if(msg.what==7){
				
				Bundle bundle = msg.getData();
				String i = bundle.getString("idx");
				Intent intent = new Intent(JoinForm.this,profileForm.class);
				intent.putExtra("i", i);
				startActivity(intent);
				finish();
				dialog.dismiss();
				Flt.interrupt();
				
			}
		}
	};
}
