package com.example.rastro;

import Thread.*;
import android.app.*;
import android.content.*;
import android.os.*;
import android.view.*;
import android.view.View.OnClickListener;
import android.widget.*;

public class loginForm extends Activity{
	String email,pwd;
	EditText editEmail,editPwd;
	Button login,fblogin;
	loginThread lT;
	RbPreference pref;
	ProgressDialog dialog = null;
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		// TODO Auto-generated method stub
		super.onCreate(savedInstanceState);
		setContentView(R.layout.loginform);
		 editPwd = (EditText)findViewById(R.id.editPwd);
		 editEmail = (EditText)findViewById(R.id.editEmail);
		 fblogin = (Button)findViewById(R.id.fblogin);
		 
		 login = (Button)findViewById(R.id.login);
		 login.setOnClickListener(new OnClickListener() {
			
			@Override
			public void onClick(View v) {
				// TODO Auto-generated method stub
				
				email = editEmail.getText().toString();
				pwd = editPwd.getText().toString();
				String url = "http://rastro.kr/app/loginChk.php";
				dialog = ProgressDialog.show(loginForm.this, "", "Loading.....");
				lT = new loginThread(email, pwd, url, mHandler,dialog);
				lT.start();
			}
		});
		 
	}
	Handler mHandler = new Handler(){
		public void handleMessage(Message msg){ 
			if(msg.what==0){
				Toast.makeText(loginForm.this,"입력된 정보가 없습니다.",Toast.LENGTH_SHORT).show();
				
				editEmail.setText("");
				editPwd.setText("");
				editEmail.setFocusable(true);
				editEmail.requestFocus();
				dialog.dismiss();
				lT.interrupt();
				
			}
			if(msg.what==3){
				pref = new RbPreference(loginForm.this);
				pref.put("email", email);
				pref.put("pwd", pwd);
				Bundle bundle = msg.getData();
				String i = bundle.getString("idx");
				Intent intent = new Intent(loginForm.this,profileForm.class);
				intent.putExtra("i", i);
				startActivity(intent);
				dialog.dismiss();
				lT.interrupt();
				finish();
			}
			if(msg.what==5){
			dialog.dismiss();
			Toast.makeText(loginForm.this, "연결 실패", Toast.LENGTH_SHORT).show();
			}
		}
	};
}
