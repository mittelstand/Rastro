package com.example.rastro;

import java.util.*;

import org.json.*;

import android.app.*;
import android.content.*;
import android.os.*;
import android.widget.*;

import com.facebook.*;
import com.facebook.model.*;

public class fbLogin extends Activity{
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		// TODO Auto-generated method stub
		super.onCreate(savedInstanceState);
		setContentView(R.layout.fblogin);
		
		Session.openActiveSession(fbLogin.this,true, new Session.StatusCallback() {	
			@Override
			public void call(Session session, SessionState state, Exception exception) {
				// TODO Auto-generated method stub
				if(session.isOpened()){
					

					if(!session.getPermissions().contains("email")) {

					String[] PERMISSION_ARRAY_READ = {"email","user_birthday"};

					List<String> PERMISSION_LIST=Arrays.asList(PERMISSION_ARRAY_READ);

					session.requestNewReadPermissions(

					new Session.NewPermissionsRequest(fbLogin.this, PERMISSION_LIST));

					}
					Request.executeMeRequestAsync(session, new Request.GraphUserCallback() {
						
						@Override
						public void onCompleted(GraphUser user, Response response) {
							// TODO Auto-generated method stub
							if(user!=null){
								JSONArray ja = new JSONArray(user);
								for(int i=0; i<ja.length(); i++){
									JSONObject jo = ja.getJSONObject(i);
									String name = jo.getString("name");
									
									String email = jo.getString("email");
									tv.setText("E-mail : "+email+"\n"+"이름 : "+name + "\n"+"생년월일 : "+dob + "\n"+"성별 : "+sex + "\n" );
								} 
								
							}
						}
					});
				}
			}
		});
		
	}
	@Override
	protected void onActivityResult(int requestCode, int resultCode, Intent data) {
		// TODO Auto-generated method stub
		super.onActivityResult(requestCode, resultCode, data);
		Session.getActiveSession().onActivityResult(fbLogin.this, requestCode, resultCode, data);
	}
}
